<html>
<head>
    <style>* {
        margin: 0;
        padding: 0;
    }

    html, body {
        width: 100%;
        height: 100%;
        font-size: 20px;
    }

    canvas {
        display: block;
        background: #eee;
    }

    #div1 {
        position: absolute;
        top: 20px;
        left: 20px;
        width: 45%;
    }

    #div2 {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 45%;
        text-align: right;
    }

    #txtRoom, button {
        font-size:24px;
    }

    #btn19, #btn20 {
        width:40%;
    }

    </style>
    <script src="https://threejsfundamentals.org/threejs/resources/threejs/r105/three.min.js"></script>
</head>
<body>
<div id="div1">
    <input type="text" id="txtRoom" list="roomList" onchange="lookAtName()"/>
    <button id="btnReset" onclick="resetSearch()">Reset</button>
    <datalist id="roomList">
        <option value="Aphrodite"/>
        <option value="Apollo"/>
        <option value="Ares"/>
        <option value="Artemis"/>
        <option value="Eros"/>
        <option value="Hades"/>
        <option value="Hebe"/>
        <option value="Helios"/>
        <option value="Hera"/>
        <option value="Heracles"/>
        <option value="Hermes"/>
        <option value="Iris"/>
        <option value="Morpheus"/>
        <option value="Metis"/>
        <option value="Nike"/>
        <option value="Poseidon"/>
        <option value="Selene"/>
        <option value="Uranus"/>
        <option value="Athena"/>
        <option value="Phoenix"/>
        <option value="Pandora"/>
        <option value="Demeter"/>
        <option value="Hermione"/>
        <option value="Roma"/>
        <option value="Odysseus"/>
        <option value="Phoebe"/>
        <option value="Orion"/>
        <option value="Zeus"/>
    </datalist>
</div>
<div id="div2">
    <button id="btn19" onclick="goFloor(19)">19</button>
    <button id="btn20" onclick="goFloor(20)">20</button>
</div>
<canvas id="canvas"></canvas>
<script>
    'use strict';
    /* global THREE */
    var camera, scene, renderer;
    var rooms = [];
    var floor = 20;

    function initCamera() {
        camera = new THREE.PerspectiveCamera(75, 1, 0.1, 2000);
        camera.rotation.set(0, 0, Math.PI / 2);
        camera.position.z = 600;
        camera.position.x = 500;
        camera.position.y = -500;
    }

    function initScene() {
        scene = new THREE.Scene();
        var axesHelper = new THREE.AxesHelper(5);
        scene.add(axesHelper);
        data.forEach(function (room) {
            if (room.floor == floor) {
                var roomObj = createRoom(room);
                rooms.push(roomObj);
                scene.add(roomObj);
            }
        });
    }

    function refresh() {
        renderer.render(scene, camera);
    }

    function createRoom(roomData) {
        var shape = new THREE.Shape();
        shape.moveTo(
            roomData.shape[0][0],
            -roomData.shape[0][1]
        );

        for (var i = 1; i < roomData.shape.length; i++) {
            shape.lineTo(
                roomData.shape[i][0],
                -roomData.shape[i][1]
            );
        }

        shape.lineTo(
            roomData.shape[0][0],
            -roomData.shape[0][1]
        );

        var roomGeo = new THREE.ExtrudeGeometry(shape, {amount: 20, bevelEnabled: false});
        var material = new THREE.MeshBasicMaterial({color: 0x999999});  // grey
        var room = new THREE.Mesh(roomGeo, material);
        room.callback = selectRoom;
        room.data = roomData;
        return room;
    }

    function selectRoom() {
        this.material.color.setHex(0xff0000ff);
        lookAtRoom(this.data);
        refresh();
    }

    function getFloor(name) {
        for (var i = 0; i < data.length; i++) {
            if (data[i].name == name) {
                return data[i].floor;
            }
        }
    }

    function lookAtName() {
        var name = document.getElementById("txtRoom").value;
        var roomFloor = getFloor(name);
        if(floor != roomFloor) {
            goFloor(roomFloor);
        }
        for (var i = 0; i < rooms.length; i++) {
            if (rooms[i].data.name == name) {
                lookAtRoom(rooms[i].data);
                return;
            }
        }
    }

    function goFloor(flr) {
        floor = flr;
        initScene();
        refresh();
    }

    function resetSearch() {
        document.getElementById("txtRoom").value = '';
        initCamera();
        initScene();
        renderer.render(scene, camera);
    }

    function lookAtRoom(roomData) {
        camera.position.set(1000, -500, 300);
        camera.up = new THREE.Vector3(0, 0, 1);
        if (roomData.lookFrom != null) {
            camera.position.x = roomData.lookFrom[0];
            camera.position.y = -roomData.lookFrom[1];
            camera.position.z = roomData.lookFrom[2];
        }
        if (roomData.lookAt != null) {
            camera.lookAt(roomData.lookAt[0], -roomData.lookAt[1], 0);
        } else {
            camera.lookAt(roomData.shape[0][0], -roomData.shape[0][1], 0);
        }
        refresh();
    }

    var data = [
        {
            name: "Aphrodite",
            shape: [[552, 395], [608, 395], [608, 445], [552, 445]],
            floor: 19
        },
        {
            name: "Apollo",
            shape: [[611, 395], [659, 395], [659, 425], [639, 445], [611, 445]],
            floor: 19
        },
        {
            name: "Ares",
            shape: [[695, 395], [743, 395], [743, 445], [715, 445], [695, 425]],
            floor: 19
        },
        {
            name: "Artemis",
            shape: [[747, 337], [820, 337], [820, 445], [747, 445]],
            floor: 19
        },
        {
            name: "Eros",
            shape: [[695, 538], [715, 518], [743, 518], [743, 542], [767, 542], [767, 567], [695, 567]],
            floor: 19
        },
        {
            name: "Hades",
            shape: [[695, 571], [769, 571], [769, 669], [695, 669]],
            floor: 19
        },
        {
            name: "Hebe",
            shape: [[695, 672], [743, 672], [743, 696], [769, 696], [769, 723], [709, 723], [695, 709]],
            floor: 19
        },
        {
            name: "Helios",
            shape: [[617, 672], [659, 672], [659, 710], [646, 723], [617, 723]],
            floor: 19
        },
        {
            name: "Hera",
            shape: [[552, 672], [613, 672], [613, 723], [552, 723]],
            floor: 19
        },
        {
            name: "Heracles",
            shape: [[484, 678], [549, 678], [549, 723], [484, 723]],
            floor: 19
        },
        {
            name: "Hermes",
            shape: [[438, 678], [480, 678], [480, 723], [451, 723], [438, 710]],
            floor: 19
        },
        {
            name: "Iris",
            shape: [[552, 231], [659, 231], [659, 392], [552, 392]],
            floor: 19
        },
        {
            name: "Morpheus",
            shape: [[695, 240], [743, 240], [743, 289], [695, 289]],
            floor: 19
        },
        {
            name: "Metis",
            shape: [[695, 337], [743, 337], [743, 392], [695, 392]],
            floor: 19
        },
        {
            name: "Nike",
            shape: [[495, 231], [549, 231], [549, 275], [495, 275]],
            floor: 19
        },
        {
            name: "Poseidon",
            shape: [[438, 231], [491, 231], [491, 275], [438, 275]],
            floor: 19
        },
        {
            name: "Selene",
            shape: [[705, 759], [769, 759], [769, 877], [729, 877], [729, 851], [705, 851]],
            floor: 19
        },
        {
            name: "Uranus",
            shape: [[445, 759], [702, 759], [702, 877], [525, 877], [525, 851], [498, 851], [498, 877], [445, 877]],
            floor: 19
        },

        {
            name: "Athena",
            shape: [[683, 156], [743, 156], [743, 168], [769, 168], [769, 265], [683, 265]],
            floor: 20
        },
        {
            name: "Phoenix",
            shape: [[683, 269], [743, 269], [743, 318], [683, 318]],
            floor: 20
        },
        {
            name: "Pandora",
            shape: [[552, 279], [608, 279], [608, 323], [552, 323]],
            floor: 20
        },
        {
            name: "Demeter",
            shape: [[552, 327], [608, 327], [608, 372], [552, 372]],
            floor: 20
        },
        {
            name: "Hermione",
            shape: [[552, 375], [608, 375], [608, 412], [552, 412]],
            floor: 20
        },
        {
            name: "Roma",
            shape: [[552, 415], [608, 415], [608, 451], [552, 451]],
            floor: 20
        },
        {
            name: "Odysseus",
            shape: [[646, 542], [646, 619], [769, 619], [769, 542]],
            floor: 20
        },
        {
            name: "Phoebe",
            shape: [[646, 622], [705, 622], [705, 683], [646, 683]],
            floor: 20
        },
        {
            name: "Orion",
            shape: [[709, 622], [769, 622], [769, 712], [709, 712]],
            floor: 20
        },
        {
            name: "Zeus",
            shape: [[671, 716], [769, 716], [769, 781], [671, 781]],
            floor: 20
        }
    ];

</script>
<script>
    (function () {

        var canvas = document.getElementById('canvas');
        // resize the canvas to fill browser window dynamically
        window.addEventListener('resize', resizeCanvas, false);
        window.addEventListener('load', init, false);
        window.addEventListener('mousedown', clickRoom, false);

        function clickRoom(event) {
            var raycaster = new THREE.Raycaster();
            var mouse = new THREE.Vector2();
            event.preventDefault();

            mouse.x = (event.clientX / renderer.domElement.clientWidth) * 2 - 1;
            mouse.y = -(event.clientY / renderer.domElement.clientHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);

            var intersects = raycaster.intersectObjects(rooms);

            if (intersects.length > 0) {
                intersects[0].object.callback();
            }
        }

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            initScene();
        }

        resizeCanvas();

        function init() {
            renderer = new THREE.WebGLRenderer({canvas});
            initCamera();
            initScene();
            renderer.render(scene, camera);
        }
    })();
</script>
</body>
</html>
